<!doctype html>
<html>
  <head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="resources/style.css">
  </head>
  <body>
    <section id="templates">
      
      <div class="chromatic keyboard"><!-- gets build using js -->
        <div class="keys"></div>
        <div class="description"></div>
      </div>
      
      <div class="chord-group">
        <h2 class="title"></h2>
      </div>
      
      <div class="interactive-form">
        <form class="form">
          <input type="button" value="<" name="shift_scale_left"></input><input type="text" name="scale"></input><input type="button" value=">" name="shift_scale_right"></input>
          <input type="text" name="chords"></input>
          <select name="preset"></select>
          <input type="submit" value="â›µ" name="update"></input>
        </form>
        <div class="result">
        </div>
      </div>
    </section>
    <section id="chords">
    </section>
    
    <section id="interactive">
    </section>
    
    <!-- <script src="node_modules/brain.js/browser.js"></script> did not work too well... -->
    <script src="src/theory.js"></script>
    <script src="src/fingering.js"></script>
    <script src="src/progression.js"></script>
    <script src="src/gui.js"></script>
    <script src="resources/progressions.json"></script>
    <script>
      (function(g/*ui*/, t/*heory*/, f/*ingering*/, p/*rogression*/) {
        /** 
         * Basic lib stuff...
         */
        function $_(id) { return document.getElementById(id); }
        /**
         * References to DOM elements...
         */
        var chordTemplate = $_("templates").getElementsByClassName("chord")[0],
          chordGroupTemplate = $_("templates").getElementsByClassName("chord-group")[0],
          chromaticKeyboardTemplate = $_("templates").getElementsByClassName("chromatic")[0],
          chordSection = $_("chords");
          
        var k = g.createKeyboard(3, 7);
          
          /**
           * Main...
           */
          g.addChordGroup(
            [
              ["r1 3+ 5 6"],
              ["1 b3 4 rb6"],
              ["1 2 r4 6"],
              ["1 rb3 5 b7"]
            ],
            "1 3 5 6",
            chordSection,
            k
          );
          
           g.addChordGroup(
            [
              ["r1", "3+", "5" , "7"],
              [1   , "b3", "5" , "rb6"],
              [1   , "3+", "r4" , "6" ],
              [1   , "rb2" , "4" , "b6" ]
            ],
            "1 3 5 7",
            chordSection,
            k
          );
          
          g.addChordGroup(
            [
              ["r1",   "3+", "5"  , "b7"],
              [  1 ,  "b3" , "b5+", "rb6"],
              [  1 ,  "b3" , "r4" , "6" ],
              [  1 ,   "r2" , "2+" , "b5+"  , "6" ] // not sure, what the best fingering is, hence two 2s
            ],
            "1 3 5 b7",
            chordSection,
            k
          );
           
          g.addBreak();
           
          g.addChordGroup(
            [
              ["r1", "b3", "5" , "b6"],
              [1   , "3+", "4" , "r6"],
              [1   , "b2", "r4", "b6" ],
              [1   , "r3+" , "5", "7" ]
            ],
            "1 b3 5 b6",
            chordSection,
            k
          );
          
          g.addChordGroup(
            [
              ["r1", "b3", "5" ,  "6"],
              [1   , "3+", "b5+", "r6"],
              [1   , "2" , "r4" , "b6" ],
              [1   , "rb3","b5+" , "b7" ]
            ],
            "1 b3 5 6",
            chordSection,
            k
          );
          
          g.addChordGroup(
            [
              ["r1", "b3", "5" , "b7"],
              [1   , "3+", "5" , "r6"],
              [1   , "b3", "r4" , "b6" ],
              [1   , "r2+" , "4" , "6" ]
            ],
            "1 b3 5 b7",
            chordSection,
            k
          );
          
          g.addChordGroup("1 2 3 4 5 b6 6 7, 1 2 b3 4 5 b6 6 7", "1 2 3 4 5 b6 6 7, 1 2 b3 4 5 b6 6 7");
      
          g.addForm(function(scale, chordDefs, resultSection) {
            
            var chordDefinitionGroups = [];
            var chordDefinitions = [];
            chordDefs.split(",").forEach(function(chordDefsOfGroup) {
                // parse chord definitions in groups, so we can split the generated chords afterwards...
                // the chord progression needs to be generated in one go!
                var chordDefObjectsOfGroup = t.parseChordDefinitions(chordDefsOfGroup);
                chordDefinitionGroups.push(chordDefObjectsOfGroup);
                chordDefinitions = chordDefinitions.concat(chordDefObjectsOfGroup);
            });
            
            // generate the chords in one go:
            var chords = p.createChordProgression(scale, chordDefinitions);
            
            // but output the chords in groups (defined by comma):
            chordDefinitionGroups.forEach(function(group) {
              var chordsOfGroup = [];
              group.forEach(function() { chordsOfGroup.push(chords.shift()); });
              g.addChordGroup(chordsOfGroup, null, resultSection);
              g.addBreak(resultSection);
            });
        }, ChromatoneProgressions);
        
        /*g.addForm(function(scale, chordDefs, resultSection) {                
          var chords = [];
          // var k = g.createKeyboard(5, 14); 
          for (var i=0; i<chordDefs.length; ++i) {
            var chord = scale.createChord(chordDefs[i]);
            f.updateFingering(chord);
            chords.push(chord);
          }
          
          g.addChordGroup(chords, null, resultSection);
        }, ChromatoneProgressions);
        */
        
      })(ChromatoneLibGUI, ChromatoneLibTheory, ChromatoneLibFingering, ChromatoneLibProgression);
    </script>
  </body>
</html>
